import{R as a,j as u,N as R}from"./index-OLMHKuv1.js";import{s as l}from"./supabase-DjvfI4ZV.js";function A({children:g}){const[p,c]=a.useState(!0),[h,b]=a.useState(null),[x,i]=a.useState(!1);return a.useEffect(()=>{var d;let t=!0,s=null;async function f(o){var n,m;try{if(!t)return;c(!0);const e=o??((n=(await l.auth.getSession()).data)==null?void 0:n.session)??null;if(!t)return;if(b(e),(m=e==null?void 0:e.user)!=null&&m.email){const{data:j,error:y}=await l.from("admins").select("id").eq("email",e.user.email).single();if(!t)return;i(!!(j&&!y))}else i(!1)}catch(e){console.error("[ProtectedRoute] check error",e),t&&i(!1)}finally{t&&c(!1)}}f();const r=l.auth.onAuthStateChange((o,n)=>{f(n)});return s=((d=r==null?void 0:r.data)==null?void 0:d.subscription)??null,()=>{t=!1;try{s&&typeof s.unsubscribe=="function"&&s.unsubscribe()}catch{}}},[]),p?u.jsx("div",{className:"admin-loading",children:u.jsx("div",{className:"loading-spinner",children:"Loading..."})}):!h||!x?u.jsx(R,{to:"/admin/login",replace:!0}):g}export{A as default};
