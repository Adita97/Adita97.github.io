import{r as d,a as y,R as A,j as e,N as L}from"./index-D9KVlpF9.js";import{s as l}from"./supabase-BErrMPu0.js";function k(){const[h,o]=d.useState(!1),[p,m]=d.useState(null),[j,f]=d.useState(null),[v,u]=d.useState(!1),[w,c]=d.useState(!0),b=y();A.useEffect(()=>{var t;let a=!0,i=null;l.auth.getSession().then(({data:{session:r}})=>{var s;a&&(console.debug("[AdminLogin] initial session",r),f(r),(s=r==null?void 0:r.user)!=null&&s.email?g(r.user.email).finally(()=>{a&&c(!1)}):a&&c(!1))});const n=l.auth.onAuthStateChange((r,s)=>{var x;a&&(console.debug("[AdminLogin] auth state change",r,s),f(s),c(!0),(x=s==null?void 0:s.user)!=null&&x.email?g(s.user.email).finally(()=>{a&&c(!1)}):(u(!1),a&&c(!1)))});return i=((t=n==null?void 0:n.data)==null?void 0:t.subscription)??null,()=>{a=!1;try{i&&typeof i.unsubscribe=="function"&&i.unsubscribe()}catch(r){console.warn("[AdminLogin] unsubscribe failed",r)}}},[]);async function g(a){try{const{data:i,error:n}=await l.from("admins").select("id").eq("email",a).single();return console.debug("[AdminLogin] admin check",a,{data:i,error:n}),i&&!n?(u(!0),!0):(u(!1),!1)}catch(i){return console.error("[AdminLogin] admin check error",i),u(!1),!1}}async function N(a){a.preventDefault(),m(null),o(!0);const i=a.target.email.value,n=a.target.password.value,{data:t,error:r}=await l.auth.signInWithPassword({email:i,password:n});if(r){m(r.message),o(!1);return}try{const{data:s}=await l.auth.getSession();f(s.session??null)}catch(s){console.warn("[AdminLogin] getSession failed after signIn",s)}if(t!=null&&t.user){if(!await g(t.user.email)){m("You are not authorized to access this area"),await l.auth.signOut(),o(!1);return}o(!1),b("/admin",{replace:!0});return}o(!1)}return w?e.jsxs("div",{className:"invite-root",children:[e.jsx("div",{className:"overlay"}),e.jsx("div",{className:"card admin-login-card",children:e.jsx("div",{className:"admin-loading",children:e.jsx("div",{className:"loading-spinner",children:"Checking session..."})})})]}):j&&v?e.jsx(L,{to:"/admin",replace:!0}):e.jsxs("div",{className:"invite-root",children:[e.jsx("div",{className:"overlay"}),e.jsxs("div",{className:"card admin-login-card",children:[e.jsx("h1",{className:"title",children:"Admin Login"}),e.jsxs("form",{onSubmit:N,className:"admin-login-form",children:[p&&e.jsx("div",{className:"error-message",children:p}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,placeholder:"Enter your email"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,placeholder:"Enter your password"})]}),e.jsx("button",{type:"submit",className:"gold-btn",disabled:h,children:h?"Logging in...":"Login"})]})]})]})}export{k as default};
